<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Visual Abductive reasoning</title>
        <!-- Bootstrap v3.0.3 -->
        <link href="https://s3.amazonaws.com/mturk-public/bs30/css/bootstrap.min.css" rel="stylesheet">
        <style>
            .bubble-highlight-1 {
            background-color: #f7b731; /* Adjust the color as needed */
            color: #fff;
            padding: 5px 10px; /* Adjust padding for desired bubble size */
            border-radius: 10px; /* Adjust border-radius for rounded corners */
            }
            .bubble-highlight-2 {
            background-color: #30dc27; /* Adjust the color as needed */
            color: #fff;
            padding: 5px 10px; /* Adjust padding for desired bubble size */
            border-radius: 10px; /* Adjust border-radius for rounded corners */
            }
            .bubble-highlight-3 {
            background-color: #7f32dc; /* Adjust the color as needed */
            color: #fff;
            padding: 5px 10px; /* Adjust padding for desired bubble size */
            border-radius: 10px; /* Adjust border-radius for rounded corners */
            }
            .bubble-highlight-4 {
            background-color: #f7317a; /* Adjust the color as needed */
            color: #fff;
            padding: 5px 10px; /* Adjust padding for desired bubble size */
            border-radius: 10px; /* Adjust border-radius for rounded corners */
            }
            li {
            margin-bottom: 15px;
            }
            .big-highlight {
                color: rgb(110, 5, 5);
                font-weight: bold;
            }
        </style>
    </head>
    <body>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
        
        <div class="task3_ins" style="max-width: 1000px; margin:20px">
            <h3>VAR Demo</h3>
            <!-- <button class="submit btn btn-primary" id="submitBtn" style="margin: 20px;" onclick="shuffleVideo()">Shuffle</button> 
            <br> -->
            <input type="text" id="identry" name="id" placeholder="Enter ID" style="margin: 20px;">
            <button class="submit btn btn-primary" id="submitBtn" style="margin: 20px;" onclick="getVideo()">Get Video</button>
            <button class="submit btn btn-primary" id="submitBtn" style="margin: 20px;" onclick="nextVideo()">Next Video</button>
            <br>
            ID: <span id="id_info"></span>
            
            <div class="three-part" style="display: flex; min-width: 800px;">
                <div class="part1" style="display: block; width: 33%;">
                    <div style="display: block; width: 95%; height: 250px; background-color: #d1e0ec; margin-bottom: 20px; padding: 5px;">
                        <h4>Part 1:</h4>
                        <div class="video-wrapper" style="display: flex; justify-content: center; align-items: center;;">
                            <video id="video1" style="display: block; max-height: 200px; max-width: 100%;" autoplay controls muted loop>
                                <source id="video1src" src="https://ubc-cv-sherlock.s3.us-west-2.amazonaws.com/oops_task2_videos/34_A_preevent.mp4" type="video/mp4" type="video/mp4">
                                <!-- <source src="https://ubc-cv-sherlock.s3.us-west-2.amazonaws.com/oops_val_v1/11_A_preevent.mp4" type="video/mp4"> -->
                            </video>
                        </div>
                    </div>
                    Task 1 (with Part 1): Given the beginning, what do you think happened next?
                    <div style="margin-left: 10px; margin-top: 10px;"> 
                        <ol>
                            <li>
                                <!-- <b>Description #1</b> -->
                                <p id="explanation1a">
                                </p>
                                <p id="checkbox2a" class="big-highlight">✅ Valid</p>
                            </li>
                            <li>
                                <!-- <b>Explanation #2</b> -->
                                <p id="explanation1b">
                                </p>
                                <p id="checkbox2b" class="big-highlight">✅ Valid</p>
                            </li>
                            <li>
                                <!-- <b>Explanation #3</b> -->
                                <p id="explanation1c"></p>
                                <p id="checkbox2c" class="big-highlight">✅ Valid</p>
                            </li>
                        </ol>
                    </div>
                </div>
                <div class="part2" style="display: block; width: 33%;">
                    <div style="display: block; width: 95%; height: 250px; background-color: #d1e0ec; margin-bottom: 20px; padding: 5px;">
                        <h4>Part 2:</h4>
                        <div class="video-wrapper" style="display: flex; justify-content: center; align-items: center;">
                            <video id="video2" style="display: block; max-height: 200px; max-width: 100%;" autoplay controls muted loop>
                                <source id="video2src" src="https://ubc-cv-sherlock.s3.us-west-2.amazonaws.com/oops_task2_videos/34_B_event.mp4" type="video/mp4" type="video/mp4"> 
                                <!-- <source src="https://ubc-cv-sherlock.s3.us-west-2.amazonaws.com/oops_val_v1/11_B_event.mp4" type="video/mp4"> -->
                            </video>
                        </div>
                    </div>
                    Task 2 (with Part 1 and Part 3): Given the beginning and end, what do you think happened in between?
                    <div style="margin-left: 10px; margin-top: 10px;">
                        <ol>
                            <li>
                                <!-- <b>Description #1</b> -->
                                <p id="explanation2a">
                                </p>
                                <p id="checkbox3a" class="big-highlight">✅ Valid</p>
                            </li>
                            <li>
                                <!-- <b>Explanation #2</b> -->
                                <p id="explanation2b">
                                </p>
                                <p id="checkbox3b" class="big-highlight">✅ Valid</p>
                            </li>
                            <li>
                                <!-- <b>Explanation #3</b> -->
                                <p id="explanation2c">
                                </p>
                                <p id="checkbox3c" class="big-highlight">✅ Valid</p>
                            </li>
                        </ol>
                    </div>
                </div>
                <div class="part3" style="display: block; width: 33%;">
                    <div style="display: block; width: 95%; height: 250px; background-color: #d1e0ec; margin-bottom: 20px; padding: 5px;">
                        <h4>Part 3:</h4>
                        <div class="video-wrapper" style="display: flex; justify-content: center; align-items: center;">
                            <video id="video3" style="display: block; max-height: 200px; max-width: 100%;" autoplay controls muted loop>
                                <source id="video3src" src="https://ubc-cv-sherlock.s3.us-west-2.amazonaws.com/oops_task2_videos/34_C_postevent.mp4" type="video/mp4" type="video/mp4">
                                <!-- <source src="https://ubc-cv-sherlock.s3.us-west-2.amazonaws.com/oops_val_v1/2_C_postevent.mp4" type="video/mp4"> -->
                            </video> 
                        </div>
                    </div>
                    Task 3 (all parts): Given the full video, explain what happened.
                    <div style="margin-left: 10px; margin-top: 10px;">
                        <ol>
                            <li>
                                <!-- <b>Description #1</b> -->
                                <p id="explanation3a">
                                </p>
                            </li>
                        </ol>
                    </div>
                </div>
            </div>
            <!-- <br>
            <b>Please check that your descriptions are: <br><br><span class="bubble-highlight-1">Relevant</span> <span class="bubble-highlight-2">Plausible</span> <span class="bubble-highlight-3">Persuasive</span> <span class="bubble-highlight-4">Non-contradictory</span></b>
            <br> -->

            <h2>Feedback Form</h2>
    <form id="feedbackForm" onsubmit="handleSubmit(event)">
        <!-- Rate the correctness -->
        <label for="correctness">Rate the correctness:</label>
        <br><input type="range" id="correctness" name="correctness" min="0" max="10" oninput="updateValue('correctnessValue', this.value)">
        <br><span id="correctnessValue">5</span>
        <br><br>

        <!-- Rate the reasoning quality or depth/thoughtfulness -->
        <label for="reasoning">Rate the reasoning quality or depth/thoughtfulness:</label>
        <br><input type="range" id="reasoning" name="reasoning" min="0" max="10" oninput="updateValue('reasoningValue', this.value)">
        <br><span id="reasoningValue">5</span>
        <br><br>

        <!-- Is it grammatically correct? -->
        <label>Is it grammatically correct?</label><br>
        <input type="radio" id="grammarYes" name="grammar" value="yes" required>
        <label for="grammarYes">Yes</label><br>
        <input type="radio" id="grammarNo" name="grammar" value="no">
        <label for="grammarNo">No</label><br><br>

        <button class="btn btn-primary" type="submit">Submit Feedback</button>
    </form>
    <br>
    <button class="btn btn-primary" onclick="downloadSubmissions()">Download Submissions</button>

           <br>
           Feedback collected so far:
            <p id="goodlist"></p>
  
        </div>
        

        <script>
            let videos = [];
    
            function loadCSV() {
                fetch('videos.csv')
                    .then(response => response.text())
                    .then(data => {
                        let rows = data.split('\n');
                        for (let row of rows) {
                            let [idx,set_id,id,video1link,video2link,video3link,explanation1a,explanation1b,explanation1c,explanation2a,checkbox2a,explanation2b,checkbox2b,explanation2c,checkbox2c,explanation3a,checkbox3a,checkbox3b,checkbox3c] = row.split(',');
                            // if (video && caption) {
                            //     videos.push({ video: video.trim(), caption: caption.trim() });
                            // }
                            videos.push({idx: idx, set_id: set_id, id: id, video1link: video1link, video2link: video2link, video3link: video3link, explanation1a: explanation1a, explanation1b: explanation1b, explanation1c: explanation1c, explanation2a: explanation2a, checkbox2a: checkbox2a, explanation2b: explanation2b, checkbox2b: checkbox2b, explanation2c: explanation2c, checkbox2c: checkbox2c, explanation3a: explanation3a, checkbox3a: checkbox3a, checkbox3b: checkbox3b, checkbox3c: checkbox3c})
                        }
                        document.getElementById('identry').value = 0
                        nextVideo();
                    });
            }
    
            // function shuffleVideo() {
            //     if (videos.length === 0) {
            //         return;
            //     }
            //     let randomIndex = Math.floor(Math.random() * videos.length);
            //     let selectedVideo = videos[randomIndex];
            //     document.getElementById('id_info').innerText = selectedVideo.set_id + ',' + selectedVideo.id;
            //     document.getElementById('video1src').src = selectedVideo.video1link;
            //     document.getElementById('video1').load();

            //     document.getElementById('video2src').src = selectedVideo.video2link;
            //     //document.getElementById('video2src').src = "";
            //     document.getElementById('video2').load();

            //     document.getElementById('video3src').src = selectedVideo.video3link;
            //     document.getElementById('video3').load();

            //     document.getElementById('explanation1a').innerText = selectedVideo.explanation1a;
            //     document.getElementById('explanation1b').innerText = selectedVideo.explanation1b;
            //     document.getElementById('explanation1c').innerText = selectedVideo.explanation1c;
            //     document.getElementById('explanation2a').innerText = selectedVideo.explanation2a;
            //     document.getElementById('explanation2b').innerText = selectedVideo.explanation2b;
            //     document.getElementById('explanation2c').innerText = selectedVideo.explanation2c;
            //     document.getElementById('explanation3a').innerText = selectedVideo.explanation3a;
            //     console.log(selectedVideo.checkbox2a);
            //     if (selectedVideo.checkbox2a === 'yes') {
            //         document.getElementById('checkbox2a').innerText = '✅ Valid';
            //         document.getElementById('explanation2a').innerText = selectedVideo.explanation1a;
            //         document.getElementById('explanation2a').style.color = 'black';
            //     } else {
            //         document.getElementById('checkbox2a').innerText = '❌ Invalid';
            //         document.getElementById('explanation2a').style.color = 'blue';
            //     }
            //     if (selectedVideo.checkbox2b === 'yes') {
            //         document.getElementById('checkbox2b').innerText = '✅ Valid';
            //         document.getElementById('explanation2b').innerText = selectedVideo.explanation1b;
            //         document.getElementById('explanation2b').style.color = 'black';
            //     } else {
            //         document.getElementById('checkbox2b').innerText = '❌ Invalid';
            //         document.getElementById('explanation2b').style.color = 'blue';
            //     }
            //     if (selectedVideo.checkbox2c === 'yes') {
            //         document.getElementById('checkbox2c').innerText = '✅ Valid';
            //         document.getElementById('explanation2c').innerText = selectedVideo.explanation1c;
            //         document.getElementById('explanation2c').style.color = 'black';
            //     } else {
            //         document.getElementById('checkbox2c').innerText = '❌ Invalid';
            //         document.getElementById('explanation2c').style.color = 'blue';
            //     }
            //     if (selectedVideo.checkbox3a === 'yes') {
            //         document.getElementById('checkbox3a').innerText = '✅ Valid';
            //     } else {
            //         document.getElementById('checkbox3a').innerText = '❌ Invalid';
            //     }
            //     if (selectedVideo.checkbox3b === 'yes') {
            //         document.getElementById('checkbox3b').innerText = '✅ Valid';
            //     } else {
            //         document.getElementById('checkbox3b').innerText = '❌ Invalid';
            //     }
            //     if (selectedVideo.checkbox3c === 'yes') {
            //         document.getElementById('checkbox3c').innerText = '✅ Valid';
            //     } else {
            //         document.getElementById('checkbox3c').innerText = '❌ Invalid';
            //     }
            // }

            function nextVideo() {
                let curr = document.getElementById('identry').value;
                curr = parseInt(curr);
                document.getElementById('identry').value = curr + 1;
                getVideo();

            }


            function getVideo() {
                if (videos.length === 0) {
                    return;
                }
                let randomIndex = document.getElementById('identry').value - 1;
                let selectedVideo = videos[randomIndex];
                document.getElementById('id_info').innerText = selectedVideo.idx+','+selectedVideo.set_id + ',' + selectedVideo.id;
                document.getElementById('video1src').src = selectedVideo.video1link;
                document.getElementById('video1').load();

                document.getElementById('video2src').src = selectedVideo.video2link;
                //document.getElementById('video2src').src = "";
                document.getElementById('video2').load();

                document.getElementById('video3src').src = selectedVideo.video3link;
                document.getElementById('video3').load();

                document.getElementById('explanation1a').innerText = selectedVideo.explanation1a;
                document.getElementById('explanation1b').innerText = selectedVideo.explanation1b;
                document.getElementById('explanation1c').innerText = selectedVideo.explanation1c;
                document.getElementById('explanation2a').innerText = selectedVideo.explanation2a;
                document.getElementById('explanation2b').innerText = selectedVideo.explanation2b;
                document.getElementById('explanation2c').innerText = selectedVideo.explanation2c;
                document.getElementById('explanation3a').innerText = selectedVideo.explanation3a;
                console.log(selectedVideo.checkbox2a);
                if (selectedVideo.checkbox2a === 'yes') {
                    document.getElementById('checkbox2a').innerText = '✅ Valid';
                    document.getElementById('explanation2a').innerText = selectedVideo.explanation1a;
                    document.getElementById('explanation2a').style.color = 'black';
                } else {
                    document.getElementById('checkbox2a').innerText = '❌ Invalid';
                    document.getElementById('explanation2a').style.color = 'blue';
                }
                if (selectedVideo.checkbox2b === 'yes') {
                    document.getElementById('checkbox2b').innerText = '✅ Valid';
                    document.getElementById('explanation2b').innerText = selectedVideo.explanation1b;
                    document.getElementById('explanation2b').style.color = 'black';
                } else {
                    document.getElementById('checkbox2b').innerText = '❌ Invalid';
                    document.getElementById('explanation2b').style.color = 'blue';
                }
                if (selectedVideo.checkbox2c === 'yes') {
                    document.getElementById('checkbox2c').innerText = '✅ Valid';
                    document.getElementById('explanation2c').innerText = selectedVideo.explanation1c;
                    document.getElementById('explanation2c').style.color = 'black';
                } else {
                    document.getElementById('checkbox2c').innerText = '❌ Invalid';
                    document.getElementById('explanation2c').style.color = 'blue';
                }
                if (selectedVideo.checkbox3a === 'yes') {
                    document.getElementById('checkbox3a').innerText = '✅ Valid';
                } else {
                    document.getElementById('checkbox3a').innerText = '❌ Invalid';
                }
                if (selectedVideo.checkbox3b === 'yes') {
                    document.getElementById('checkbox3b').innerText = '✅ Valid';
                } else {
                    document.getElementById('checkbox3b').innerText = '❌ Invalid';
                }
                if (selectedVideo.checkbox3c === 'yes') {
                    document.getElementById('checkbox3c').innerText = '✅ Valid';
                } else {
                    document.getElementById('checkbox3c').innerText = '❌ Invalid';
                }
            }

            // List to store the submissions
            const submissions = [];
            // List to store the submissions
            //const submissions = JSON.parse(localStorage.getItem("submissions")) || [];

            // Function to handle form submission
            function handleSubmit(event) {
                event.preventDefault(); // Prevent the form from submitting normally

                // Get the form data
                const correctness = document.getElementById("correctness").value;
                const reasoning = document.getElementById("reasoning").value;
                const grammar = document.querySelector('input[name="grammar"]:checked')?.value;
                const id = document.getElementById('id_info').innerText;

                // Create a submission object and add it to the list
                const submission = { id, correctness, reasoning, grammar };
                submissions.push(submission);

                // Save to localStorage
                //localStorage.setItem("submissions", JSON.stringify(submissions));

                // Clear form after submission and notify user
                document.getElementById("feedbackForm").reset();
                nextVideo();
                document.getElementById('reasoningValue').innerText = 5;
                document.getElementById('correctnessValue').innerText = 5;
                document.getElementById('goodlist').innerText = JSON.stringify(submissions, null, 2);
            }

            // Function to update the displayed slider value
            function updateValue(elementId, value) {
                document.getElementById(elementId).textContent = value;
            }

            // Function to download submissions as a JSON file
            function downloadSubmissions() {
                const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(submissions, null, 2));
                const downloadAnchor = document.createElement('a');
                downloadAnchor.setAttribute("href", dataStr);
                downloadAnchor.setAttribute("download", "submissions.json");
                downloadAnchor.click();
            }

            
    
            // Load CSV data when the page loads
            window.onload = loadCSV;
        </script>
    </body>